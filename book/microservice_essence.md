# マイクロサービスとは

協調して動作する小規模で自律的なサービス

# 利点

+ サービス間がAPIを介し疎結合なため、サービス毎に特化した技術を選定可能

+ レジリエンス(回復性)…サービス境界が障害に対する隔壁となる。

+ サービス毎の小さな単位でスケール可能

+ デプロイが容易

+

# 欠点

+ サービス呼び出し＝通信のため
  + パフォーマンス悪化
  + 失敗のリスク増
  + トランザクション適用困難

+

# 必要な概念

## 小さく、かつ１つの役割に専念

+ 凝集性、疎結合

+ 「単一責任原則」…変更する理由が同じものは集める、違うものは分ける。

+ 適切な粒度…サービス、チームにより異なり、唯一の回答は無し。ある人の経験則『二週間で書き直せるサイズ』

+ 自律性…黄金律「他には何も変更せずに、単独でサービスの変更やデプロイを行えるか」

+ 「境界付けられたコンテキスト」(ドメイン駆動設計)

# アンチパターンと解消法

| アンチパターン | 理由 | 解消法 |
| サービス間通信ロジックに共有コードを使用 | サービス間の結合点となり、各サービスが共有コードに依存 | Yagniを破る |
| プロダクトのスタートアップからマイクロサービス化 | ユースケースひいてはサービス境界が定まらず、要件変更・機能追加時のコストが大きくなる | ユースケース定まるまでモノリシックを許容 |
| データベース統合…複数のサービスによる特定の同一テーブルへのアクセス | テーブル変更が使用する全サービスに影響 | 1サービスに担わせ、他サービスはそのサービスにアクセスする |
| オーケストレーション手法(Facade? Mediator?)…サービスを束ねる(管理する)サービスを作る | 個別サービスがドメインによらない貧血症のCRUDベースのサービスになる | コレオグラフィ手法…各サービスは束ねず非同期イベントのPub/Subで連携 |

# アーキテクトとして注意すること

+ サービス内で起こることには寛容に、サービス間で起こることには厳格に対処する

+ 「戦略的目標」に基づき「原則」(10未満が理想。事例：Herokuの12Factors)を決め、「原則」に基づき「プラクティス」("コーディング指針"や"全てのログを保存する"ことや"サービス間統合形式はREST"等)を決める
