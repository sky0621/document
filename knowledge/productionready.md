# モノリスからマイクロサービスへ

## ■モノリスの不

<dl>
  <dt>・成長に応じたコードベース肥大化によりメンテナンスが困難</dt>
  <dd>・リファクタリング難(＝技術的負債蓄積)</dd>
  <dd>・デプロイ時間増加(＝即時反映できず、問題有無検出に時間がかかる)</dd>
  <dd>・運用コスト増加(1箇所の不具合が全体に影響。改修リリース＝サービス全体のリリース)</dd>
</dl>

<dl>
  <dt>・負荷に応じた機能毎のスケールができない</dt>
</dl>

<dl>
  <dt>・新テクノロジー採用が困難(サービス、組織が緩やかに古くなり人材採用難を招く)</dt>
</dl>

## ■マイクロサービスによる不の解消

<dl>
  <dt>マイクロサービスは、それぞれ責任をもって1つの機能をこなす小さなアプリケーション</dt>
</dl>

<dl>
  <dt>小さなサービスゆえ、</dt>
  <dd>・コードベース肥大化軽減</dd>
  <dd>・負荷に応じてスケール可</dd>
  <dd>・サービスに適した新テクノロジー採用可</dd>
</dl>

## ■マイクロサービスは複雑な生態系「エコシステム」として捉える

<dl>
  <dt>レイヤ1：ハードウェア</dt>
  <dd>物理サーバ(AWS等クラウド含む)、コンテナ(Docker等)、構成管理(Ansible等)、ホストレベルの監視(Mackerel等)、ホストレベルのロギングが含まれる</dd>

<dl>
  <dt>レイヤ2：通信</dt>
  <dd>他のレイヤ全てとつながり、境界は不明確</dd>
  <dd>ネットワーク、DNS、RPC(他サービスの直接呼び出し)orメッセージング(SQS等)、APIエンドポイント、サービス検出(Consul等)、サービスレジストリ、負荷分散(ELB等)が含まれる</dd>
  <dd>※メッセージングには、RESTに比べ変更が難しく、中央集権的ゆえ単一障害点になりうる欠点がある</dd>

<dl>
  <dt>レイヤ3：アプリケーションプラットフォーム</dt>
  <dd>セルフサービス内部ツール、開発環境(最も安定性、信頼性が高いのは本番環境のミラー)、CI(Jenkins等)、マイクロサービスレベルの監視とロギング(TD等？)が含まれる</dd>

<dl>
  <dt>レイヤ4：マイクロサービス</dt>
  <dd>マイクロサービス及び固有の構成情報(構成管理、デプロイツール等)が含まれる</dd>

## ■マイクロサービスの不

<dl>
  <dt>逆コンウェイの法則</dt>
  <dd>アーキテクチャに即した組織構造になる＝担当サービスへの専門分化でエコシステム全体視点が欠如</dd>

<dl>
  <dt>技術的スプロール(不規則な成長)</dt>
  <dd>技術、ツール、方式選定の自由＝100のサービス(チーム)があれば100の技術、ツール、方式がある</dd>

<dl>
  <dt>多種多様な障害発生</dt>
  <dd>サービス間が通信により接続、依存するため、1サービスの障害がもたらす余波で起こりうる障害が多岐にわたる</dd>

<dl>
  <dt>リソースの奪い合い</dt>
  <dd>インフラリソースのみならずエンジニアリソースも奪い合う</dd>

# プロダクションレディ(本番対応可)なマイクロサービス
