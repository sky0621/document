# プロダクションレディ(本番対応可)なマイクロサービス

プロダクションレディ　＝　本番トラフィックを任せられるサービス

上記を実現できているかの測定に使われるのがサービスの可用性についてのSLA（サービスレベル契約）

可用性が高い＝ダウンタイムがほとんどないことを表すが、可用性はあくまで目標

マイクロサービス開発においては、開発者はかなりの自由を得る

ただし、本番対応たりうる可用性を達成するためには、アーキテクチャ、運用、組織に関する高い標準を満たす必要がある

なぜ自由なはずのマイクロサービス開発に標準が必要か？

過去50年のソフトウェア開発を学べば、自由をもたらしエントロピーを下げるのは標準化だとわかるはず（「形式が解放をもたらす」）

標準に則っているかの審査を職務とするSRE（Site Reliability Engineering）の登場

以下、８つの標準（システム要件）

## (1)安定性

### ・安定した開発サイクル

### ・安定したデプロイプロセス

### ・安定した導入、非推奨手続き

◆ヒント◆

　ステージング環境デプロイと本番環境デプロイの間に位置する”カナリアデプロイ（本番対応ホストの２～５％が含まれる小さなプール）”

## (2)信頼性

### ・確実なデプロイのためのプロセス

### ・依存関係の障害に対処するための計画、影響の緩和と障害からの保護

### ・確実なルーティングと検出

## (3)スケーラビリティ

### ・明確に定義された質的、量的な成長の判断基準

### ・リソースのボトルネックと要件の明確化

### ・ていねいで正確なキャパシティプランニング

### ・トラフィックのスケーラブルな処理

### ・依存関係のスケーリング

### ・スケーラブルなデータストレージ

◆ヒント◆

　・質的な成長　・・・ページビューでスケールするのか、発注数でスケールするのか等

　・量的な成長　・・・毎秒何リクエストを処理できるか等

## (4)耐障害性、(5)大惨事対応

### ・発生し得る大惨事や障害のシナリオを明らかにし、その対策を計画する

### ・単一障害点を明らかにして解決する

### ・障害の検出、修正戦略を用意する

### ・コードテスト、ロードテスト、カオステストを通じて回復性をテストする

### ・障害に対する準備としてトラフィックをていねいに管理する

### ・インシデントや機能停止を適切に、生産的に処理する

## (6)パフォーマンス

### ・可用性の適切なSLA（サービスレベル契約）

### ・適切なタスク処理

### ・リソースの効率的な利用

## (7)監視

### ・主要メトリック

#### 【ホスト、インフラストラクチャーの主要メトリック】

　　・CPU　

　　・RAM

　　・スレッド

　　・ファイルディスクリプタ

　　・データベース接続

#### 【マイクロサービスの主要メトリック】

　　・言語固有メトリック

　　・可用性

　　・SLA

　　・レイテンシ

　　・エンドポイントの成功

　　・エンドポイントのレスポンス

　　・エンドポイントのレスポンス時間

　　・クライアント

　　・エラーと例外

　　・依存関係

### ・スタック全体にわたる適切なロギングとトレーシング

### ・サービスの健全性を正確に反映していてわかりやすいダッシュボード

### ・ランブックに対応方法が書かれた、効果的でアクション可能なアラート

### ・オンコールローテーションの継続的な実施

## ■ドキュメント

### ・マイクロサービスについてのすべての重要情報を最新の完全な形で記録した一元管理されたドキュメント

#### 　【個々のマイクロサービス毎に備えるべきドキュメント要素】

　　[1] 説明　・・・短く明瞭に。

　　[2] アーキテクチャ図　・・・エンドポイント、どのサービス（内部・外部（AWS等含む））からコールされるか、依存するサービスやストレージ等のリソース、データベースや他サービス情報のキャッシュ有無を含める。

　　[3] 連作先とオンコール情報　・・・サービスが問題を起こしているときやサービスについて質問があるときに誰に連絡すればよいかを記載。

　　[4] リンク　・・・リポジトリへのリンク、使っているテクノロジーに関する情報へのリンク等。

　　[5] オンボーディング／開発者ガイド　・・・サービスの動かし方（コードのチェックアウト、環境設定、サービス起動、起動していることの確認）を記載。

　　[6] リクエストフロー／エンドポイント／依存関係　・・・アーキテクチャ図に記載した同情報の詳細。依存関係のSLAや障害発生時の代替サービス、キャッシュ、バックアップに関する情報を記載。

　　[7] オンコールランブック　・・・サービスが発する全てのアラートとトリアージ方法、問題の緩和・解決手順を簡潔に記載。

　　[8] FAQ　・・・誰かが質問してきた都度、追記。

### ・開発者、チーム、エコシステムレベルでの組織的な理解
