## CAP定理

### 整合性・一貫性(Consistency)

全てのデータ読み込みは、最新の書き込みデータ、またはエラーのどちらかを受け取る。

複数のノードで同じ答えが得られる。

### 可用性(Availability)

単一障害点が存在しない。
(ノード障害が起きても、ダウンしていないノードが応答を返す。)

すべてのリクエストがレスポンスを受け取る。

### 分断耐性(Partition-tolerance)

通信障害によるメッセージ損失が起きても、システムは処理を継続できる。
(通信可能なサーバが複数のネットワークに分断されるケース)

### 障害シナリオと対応策

１つのサービスが２つのデータセンターにデプロイされ同期を取っている場合に、障害が発生してデータセンター１への変更内容が

データセンター２に同期されなかったとすると、ユーザに対する見え方をどうすべきか？

#### APシステム（＝整合性・一貫性を犠牲にする）★結果整合性のあるシステム★

サービスを停止させない。

その場合、整合性・一貫性が保てないため、障害シナリオでいうと、データセンター２が古いデータとしてもユーザに見せるという対応になる。

将来的にはデータセンター２のデータも最新化されるため、APシステムは「結果整合性のあるシステム」であると言える。

#### CPシステム（＝可用性を犠牲にする）★強い整合性のあるシステム★

整合性を確保するまではリクエストに対するレスポンスを返さない。

困難な分散トランザクションが必要になる。

#### 現実解

システム自体をどれほど整合性のあるものにしても、不整合を生じる全てを把握することはできない。

そのため、多くの状況で結局はAPシステム（＝結果整合性のあるシステム）が適切になる。

CPシステムは構築が複雑なことに加え、どちらにしても全ての問題を修正することはできない。

## ACID vs BASE

### ACID

・原子性(Atomicity)

・一貫性(Consistency)

・独立性(Isolation)

・永続性(Durability)

### BASE

Basically Available, Soft-state, Eventual consistency
